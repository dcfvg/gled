# glisser-editer

# USAGE: glisser-editer 
# 

content="/Users/benoit/Dropbox/glisser-editer"

docw=2480
doch=3508
docsize=$docw"x"$doch
last="$content/step/last.jpg"

parchive="$content/archive"
pinbox="$content/inbox"
pprint="$content/print"
pstep="$content/step"
ptrash="$content/trash"

for pdoc in `find $pinbox \( -iname \*.png -o  -iname \*.pdf -o -iname \*.jpg \) -type f | xargs ls -rt`
do
  
  box=$(basename $(dirname $pdoc))
  doc=$(basename $pdoc)
  
  blin=${box:0:1}
  bcol=${box:2:1}
  
  echo "$blin:$bcol ($doc)"
  
  filemtime=$(perl -MPOSIX -le 'print strftime "%s",localtime ((stat $ARGV[0])[9])' $pdoc)
  
  # resize and archive documents
  
  pdocarchive="$parchive/$filemtime.$blin-$bcol.$doc"
  convert -format jpg -resize $docsize -extent $docsize $pdoc \
  -gravity south \
  -stroke '#000C' -strokewidth 2 -annotate 0 "$blin:$bcol ($doc)" \
  -stroke  none   -fill white    -annotate 0 "$blin:$bcol ($doc)" \
  $pdocarchive
  
  step="$pstep/$filemtime.jpg"

  composite $pdocarchive -geometry "+$((docw*bcol))+$((doch*blin))" $last $step
  
  open $step
  
  mv $pdoc "$ptrash/$box/$doc"
  rm $last
  cp $step $last
  
  pprintpdf="$pprint/all/$filemtime.pdf"
  convert -format pdf $step "$pprint/all/$filemtime.pdf"
  
  cp $pprintpdf "$pprint/benoit/$filemtime.pdf"
  cp $pprintpdf "$pprint/tanguy/$filemtime.pdf"
  
done